<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="CSS/styles.css" />
    <title>Rainbow Library</title>
  </head>
  <body>
    <div class="front">
      <h1>Rainbow Library</h1>
    </div>

    <canvas
      id="draw_canvas"
      width="256"
      height="256"
      style="width: 240px; height: 240px;"
    ></canvas>

    <ul>
      <div class="storagebox">
        <p>
          <button id="red" onclick="draw('red')">赤</button>
          <button id="orange" onclick="draw('orange')">橙</button>
          <button id="yellow" onclick="draw('yellow')">黄</button>
          <button id="green" onclick="draw('green')">緑</button>
          <button id="skyblue" onclick="draw('skyblue')">薄青</button>
          <button id="blue" onclick="draw('blue')">青</button>
          <button id="purple" onclick="draw('purple')">紫</button><br />
          <button id="send">貯める</button>
          <button id="clear">次の空へ</button>

          <!-- <button onclick="save()">届ける</button> -->
          <!-- ローカルストレージの時に利用
            <button onclick="save()">go strage</button>
          <button onclick="get()">get Rainbow</button>
          <button id="clear">eat</button> -->
        </p>
      </div>
    </ul>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

    <!-- <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyBLuFkZyBXc-ixaNBFuTJ7zOgfNuE9zuEs",
        authDomain: "rainbow-52129.firebaseapp.com",
        databaseURL: "https://rainbow-52129.firebaseio.com",
        projectId: "rainbow-52129",
        storageBucket: "rainbow-52129.appspot.com",
        messagingSenderId: "306450167944",
        appId: "1:306450167944:web:3b45d214a3079af4"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      //     service firebase.storage {
      // match /b/{bucket}/o {
      //   match /{allPaths=**} {
      //     allow read, write: if request.auth != null;
      //   }
      // } -->

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyCZC3KIVd44f673YREFuXp5bccBw1uiXsE",
        authDomain: "rainbow-fff73.firebaseapp.com",
        databaseURL: "https://rainbow-fff73.firebaseio.com",
        projectId: "rainbow-fff73",
        storageBucket: "rainbow-fff73.appspot.com",
        messagingSenderId: "356906457631",
        appId: "1:356906457631:web:b0bf6c0d5fc9c3e3"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      const newPostRef = firebase.database().ref();

      // 以上までfirebase
    </script>

    <script>
      // 画像の読み込み
      function draw(color) {
        let cv = document.getElementById("draw_canvas");
        let context = cv.getContext("2d");

        context.fillStyle = color;

        let x = Math.random() * 128;
        let y = Math.random() * 128;
        let w = Math.random() * 140;
        let h = Math.random() * 140;

        color = context.fillRect(x, y, w, h);
      }

      // saveとgetがローカルストレー
      // function save() {
      //   let cv = document.getElementById("draw_canvas");
      //   let context = cv.getContext("2d");

      //   let data = cv.toDataURL();

      //   firebase("draw_data", data);
      //   location.reload();
      // }

      // function get() {
      //   let data = localStorage.getItem("draw_data");

      //   let img = new Image();

      //   img.onload = view;
      //   img.src = data;
      // }

      function view(e) {
        let img = e.target;

        let cv = document.getElementById("draw_canvas");
        let context = cv.getContext("2d");

        context.drawImage(img, 0, 0);
      }

      function init() {
        let cv = document.getElementById("draw_canvas");
        let context = cv.getContext("2d");

        context.fillStyle = "#e0e0e0";
        context.fillRect(0, 0, 256, 256);
      }

      // clear クリックイベント
      $("#clear").on("click", function() {
        localStorage.clear();
        $("#list").empty();
        location.reload();
        // alert("Yummy!");
      });

      // 下記からfirebase処理エリア
      // 1 データ送信
      $("#send").on("click", function() {
        let cv = document.getElementById("draw_canvas");
        let context = cv.getContext("2d");

        let data = cv.toDataURL();

        location.reload();
        newPostRef.push({
          // red: $("#red").val(),
          // orange: $("#orange").val(),
          // yellow: $("#yellow").val(),
          // green: $("#green").val(),
          // skyblue: $("#skyblue").val(),
          // blue: $("#blue").val(),
          // purple: $("#purple").val()
          firebase: data,
          canvas: $("#draw_canvas").val()
        });
        console.log(red);
        // get();
      });

      // ２ データ受信
      newPostRef.on("child_added", function(data) {
        let v = data.val();
        let k = data.key;

        // 表面へ現れるように処理
        // let r = v.red;
        // let o = v.orange;
        // let y = v.yellow;
        // let g = v.green;
        // let s = v.skyblue;
        // let b = v.blue;
        // let p = v.purple;

        let firebasedesu = v.firebase;
        let canvasdesu = v.canvas;

        // $("#draw_canvas").prepend(r);
        // $("#draw_canvas").prepend(o);
        // $("#draw_canvas").prepend(y);
        // $("#draw_canvas").prepend(g);
        // $("#draw_canvas").prepend(s);
        // $("#draw_canvas").prepend(b);
        // $("#draw_canvas").prepend(p);

        console.log(firebasedesu);

        $("body").append('<img src="' + firebasedesu + '">');
        //bodyにしたら表示される　#draw_canvaでもコンソールで見るとはいつてる
        // $("#draw_canvas").prepend(firebasedesu);
        // $("#draw_canvas").prepend(canvasdesu);
        // // get();
      });
    </script>
  </body>
</html>
